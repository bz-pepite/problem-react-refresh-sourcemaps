# Describe the bug

In developement mode (vite dev server) with @vitejs/plugin-react-refresh, the sourcemaps seems to not work for some libraries inside an app built by vite.
There are two packages in the monorepo :

- @foo/react-utils : the library containing the react component named "Button". react typescript library. built by vite in library mode.
- @foo/my-app : application consuming the component "Button" from the library. react typescript application built by vite

If I start the developpement server of '@foo/my-app' and I try to put a breakpoint in google chrome in the code of Button.tsx (in the onClick callback), but I can't. The sourcemaps do not contains usefull informations.

# Reproduction

checkout code

```shell
yarn install

cd packages/react-utils

yarn build

cd ../my-app

yarn dev
```

Launch google chrome, in devtools try to set a break point in the file Button.tsx line 11. (break point inside "onClick" function). impossible to set break point.

# Aditional information

The sourcemaps in the library (react-utils) generated by vite are correct.

But the sourcemaps served by the dev server of "my-app" are not coherent with the modified file `react-utils.es.js` served by the dev server.

# Explaination and Fix

Problem is in @vitejs/plugin-react-refresh.

@vitejs/plugin-react-refresh uses babel. According to me, there is a problem in the configuration of babel in the plugin @vitejs/plugin-react-refresh

after calling all plugins, vite combines the sourcemaps generated by all plugins.

each plugin receive some code as input and outputs some code and an optional sourcemap.

vite assumes that the sourcemaps ouputed by the plugin should be used to map the plugin output code to the plugin input code and not to map the plugin output code to the typescript source code.

Babel receive some transpiled code from my library as input
In the input code, there is the line //# sourceMappingURL=react-utils.es.js.map
Babel resolves the sourcemap of the library and outputs a sourcemap that maps the output code to the typescript source code and not to the input source code.

When vite tries to merge all sourcemaps, it tries to merge the sourcemaps from the library and the one from @vitejs/plugin-react-refresh. This lead to merge incompatible sourcemaps files and an invalid result.

## Fix found

in vite repository
packages/plugin-react-refresh/index.js

add the line of code in bable configuration (add this near line 126)

```javascript
inputSourceMap: /** @type {any} */ (false),
```

With false, babel will not load sourcemap from //# sourceMappingURL=react-utils.es.js.map

The only problem that I see in the provided fix is that I need to cast. It is because the provided types from @types/babel\_\_core/index.d.ts line 215

```typescript
    inputSourceMap?: InputSourceMap | null;
```

do not corresponds to information from
https://babeljs.io/docs/en/options#inputsourcemap

```
inputSourceMap
Type: boolean | SourceMap
Default: true


```

I will provide a pull request
